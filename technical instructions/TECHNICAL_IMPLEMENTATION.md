# üõ†Ô∏è Technical Implementation Details: Finance App

This document provides an exhaustive technical specification of the Finance App's implementation, covering architecture, data structures, communication protocols, and core algorithms.

---

## 1. üèóÔ∏è High-Level Architecture

The application follows a **Decoupled Monolith** pattern with a clear separation between the static frontend and a lightweight Node.js API server.

### **System Components**
- **Client Tier**: Vanilla Javascript SPA (Single Page Application) using standard Web APIs (Fetch, DOM, IndexedDB shim).
- **Service Tier**: Express.js server providing RESTful endpoints for CRUD operations and lifecycle management.
- **Storage Tier**: Local JSON persistence (`data.json`) acting as a document database.

---

## 2. üì° API Specifications

The server exposes a REST-like API for data management and system control.

### **Data Operations**
- **`GET /api/data`**: Returns the entire contents of `data.json`.
- **`POST /api/data`**: Updates or initializes a specific data store.
  - **Payload**: `{ storeName: string, data: any, key?: string }`
  - **Logic**: If `key` is provided, updates `db[storeName][key]`. Otherwise, replaces `db[storeName]`.

### **System Control**
- **`POST /api/heartbeat`**: Resets the server's auto-shutdown timer.
  - **Response**: `{ status: 'alive' }`

---

## 3. üíæ Data Model & Schemas

The system manages three primary data stores within `data.json`.

### **Accounts Store (`accounts`)**
An array of objects representing financial commitments.
```typescript
interface Account {
  id: number;
  name: string;
  category: string;
  type: string; // e.g., 'CONS', 'FIN', 'GOV'
  monthlyPayment: number;
  annualPayment: number;
  hasReminder: 'Yes' | 'No';
  status: 'Active' | 'Planned' | 'Dormant' | 'Cancelled';
  priority: 'Critical' | 'Essential' | 'Important' | 'Optional';
}
```

### **Profile Store (`profile`)**
A keyed object containing profile cards.
- **Key**: `cards`
- **Value**: `Array<ProfileCard>`
```typescript
interface ProfileCard {
  id: string;
  type: 'adult' | 'child' | 'pet';
  emoji: string;
  displayName: string;
  fullName: string;
  dateOfBirth?: string;
  // Dynamic fields based on type
  job?: string;
  income?: string;
  school?: string;
  breed?: string;
}
```

---

## 4. ‚öôÔ∏è Core Implementation Logic

### **üîÑ Heartbeat & Lifecycle Management**
Implemented to ensure the local server does not leak memory or stay active in the background once the user closes the application.
- **Server Timer**: Initialized at `15,000ms`.
- **Client interval**: Every `5,000ms`.
- **Termination**: Uses `process.exit(0)` for clean termination.
- **Network Resilience**: Client uses `{ keepalive: true }` in fetch to ensure completion during tab unload events.

### **üìÖ Financial Projection Algorithm**
Calculates a 3-year (36-month) rolling balance projection.
1. **Bootstrap**: Fetches starting balance and baseline income from `TIMELINE_CONFIG`.
2. **Aggregation**: Sums all `monthlyPayment` values from the `accounts` store where `status === 'Active'`.
3. **Iterative Projection**:
   ```javascript
   for (let i = 1; i <= 36; i++) {
     balance += (monthlyIncome - totalMonthlyExpenses);
     storeSnapshot(month, balance);
   }
   ```
4. **Visualization**: Data is piped to a `Chart.js` Line controller with a `tension: 0.4` (Cubic Bezier) for smooth rendering.

---

## 5. üé® UI/UX Implementation

### **Design System**
Controlled via `config.js` and CSS variables in `styles.css`.
- **Colors**: HSL-based palette for consistent saturation and lightness.
- **Responsive Grid**: Uses `display: grid` with `grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))` for the profile section.

### **Modal Management**
A singleton modal system that dynamically hydrates forms based on the `CARD_TEMPLATES` object, allowing for high extensibility of profile types without modifying the core HTML.

---

**Generated by Antigravity**
*Version: 1.1.0*
